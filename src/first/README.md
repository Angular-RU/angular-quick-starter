<h2 id="s1">Первые шаги</h2>

Хорошие инструменты для разработки делают вашу работу более комфортной, даже если вам нравится делать все вручную. [Angular CLI](https://github.com/angular/angular-cli) — это интерфейс командной строки, который позволяет вам быстро создавать проекты, добавлять файлы и выполнять множество определенных задач, такие как тестирование, сборка и развертывание. 

Основная цель этого раздела — создать и запустить простое Angular-приложение на TypeScript с использованием Angular CLI и в дальнейшем придерживаться официального [Style Guide](https://angular.io/guide/styleguide) руководства, которые специфицирует и стандартизирует проекты на Angular. В конце концов, вы будете иметь базовое понимание того, как разрабатывать приложения с помощью CLI. Однако, сначала определимся, зачем нам TypeScript?

<h3 id="s1-1"> Зачем нам TypeScript? </h3>

<img src="https://i1.wp.com/www.mithunvp.com/wp-content/uploads/2016/02/transpiling.png"  /><br>

TypeScript — это JavaScript (ES6/ES7/ES8/...) + информация о типах. То есть если вы знаете ES6+, то вы автоматически знаете TypeScript (добавится только информация о типах и некоторые нюансы, но в целом они строго следуют стандарту). TypeScript - это не Dart, который является другим языком. Это надстройка над JavaScript, которая позволяет в рамках очень больших проектов (таких, как сам Angular, который сам по себе очень большой проект) улучшить управление сложностью, получить статический анализ, мы имеем возможность пользоваться аннотациями, типизацией, наследованием, интерфейсами, а самое главное - модулями. В крупных проектах эта информация действительно позволяет избавиться от огромного набора ошибок. В интернете существует достаточно большое количество примеров и руководств по написанию приложений на TypeScript, но в нашем случае мы подготовили вам [базовый starter kit](https://github.com/Angular-RU/webpack-typescript-starter), который работает под управлением системы сборки Webpack.

### Шаг 1. Настройка окружения

Перед тем, как начать разрабатывать, вам необходимо настроить себе окружение. Установите [Node.js и npm](https://nodejs.org/en/download/) (если вы еще не установили их) себе на компьютер. Убедитесь, что вы используете Node.js версии не ниже 6.9.x и npm не ниже 3.x.x (для этого достаточно выполнить в терминале node -v и npm -v). 

Затем установите Angular CLI глобально.

```bash
npm install -g @angular/cli
```

Как правило, этот шаг проделывается один раз, и в будущем его выполнение уже не потребуется.

### Шаг 2. Создание нового проекта

Создайте новое приложение (разворачивание каркаса), выполнив следующие команды: 

```bash
ng new my-app
```
На этом шаге проявите терпение. Angular будет подтягивать все необходимые зависимости для вашего приложения, и большая часть времени будет потрачена на установку пакетов npm.

### Шаг 3: Запуск веб-приложения в режиме разработки

Перейдите в каталог проекта и запустите веб-сервер. 

```bash
cd my-app
ng serve --open
```

Команда ng serve запускает веб-сервер, а также прослушивает каталог c исходниками вашего приложения и при изменениях в этих исходных файлах пересобирает проект «на лету». Стоит отметить, что в таком режиме проект не сохраняется на диске, он записывается непосредственно в оперативную память. 

Использование ключа --open (или просто -o) означает, что после сборки проекта, автоматически откроется ваш браузер (по умолчанию выбранный в операционной системе). 

В открытой вкладке http://localhost:4200/ по умолчанию вы уведите стандартный макет Angular приложения.

![](https://angular.io/generated/images/guide/cli-quickstart/app-works.png)

### Шаг 4: Редактирование своего первого Angular компонента

По умолчанию Angular CLI создает для вас базовый компонент. Этот базовый компонент является корневым, он связан с селектором app-root. Вы можете найти его по следующему пути в каталоге ./src/app/app.component.ts. 

В этом файле вы увидите следующее:

```ts
...

@Component({
  selector: 'app-root',
  templateUrl: './app.component.html',
  styleUrls: ['./app.component.css']
})
export class AppComponent {
  title = 'app';
}
```

[@Component](https://angular.io/api/core/Component) — это один из базовых декораторов в Angular. Декораторы — это альтернатива для аннотаций (пример из Java), предложенная Yehuda Katz в стандарт ECMAScript 2016. Декораторы позволяют не только аннотировать метаданными объекты, но и модифицировать классы, методы и свойства. Также декорирование - это приём программирования, который позволяет 
взять существующую функцию и изменить/расширить ее поведение. Во многих случаях код с использованием декораторов будет чище, красивее и эффективнее. 

![image](https://media.giphy.com/media/neagi3AslKow/giphy.gif)

Декоратор получает функцию (в нашем случае, класс AppComponent) и возвращает обертку, которая делает что-то своё «вокруг» (magic) вызова основной функции. Что конкретно делает декоратор [@Component](https://angular.io/api/core/Component) вы можете [посмотреть тут](https://stackoverflow.com/questions/40983890/what-does-component-decorator-exactly-do). 

Итак, самое очевидное, что вы можете сделать сейчас для своего компонента, это поменять его title, к примеру: 

```ts
...
export class AppComponent {
  title = 'My First Angular App';
}
```

Как только вы внесете изменения в файле и сохраните их, браузер автоматически перезагрузит изменения (hot reloading). Конечно же, вы можете легко вносить изменения в стили вашего компонента. 

Откройте файл .src/app/app.component.css и задайте компоненту некоторые стили: 

```css
h1 {
  color: #369;
  font-family: Arial, Helvetica, sans-serif;
  font-size: 250%;
}
```

![](https://angular.io/generated/images/guide/cli-quickstart/my-first-app.png)

Правда, тут стоит сразу отметить следующий момент: если вы попытаетесь сделать так: 

```css
body {
  background: red;
}

app-root {
  background: blue;
}
```

то ничего не изменится, фон страницы не будет красным, а фон самого компонента не будет синим. И если мы посмотрим в код страницы, то увидим следующее: 

![](https://habrastorage.org/webt/ak/f0/si/akf0sizbmq19q9cgfsys2tkkrum.png)

Дело в том, что Angular по умолчанию инкапсулирует CSS (кроссбраузерно эмулирует Shadow DOM), чтобы стили одного компонента не сломали или переопределили стили другого. Поэтому ни в коем случае не используйте имя селектора компонента или внешние имена селекторов для задания его стилей. Атрибуты для инкапсуляции CSS кода генерируются только для дочерних элементов этого компонента. 

Некоторые утверждают, что если на странице используется огромное количество компонентов, Angular проделывает лишнюю работу и нагружает наш процессор, что сказывается на скорости, к тому же, если вы используете какую-нибудь css-методологию (BEM, SMACSS), то вероятнее всего вы напишете хорошую верстку и css код, не требующий для этого инкапсуляции со стороны Angular. Для этого вы можете просто указать дополнительный параметр в декораторе: 

```ts
@Component({
  ...
  encapsulation: ViewEncapsulation.None
  ...
})
```

Более подробно вы можете [прочитать тут](https://angular.io/guide/component-styles#view-encapsulation).

### Что дальше?

Шаги, описанные выше - это все, что необходимо для простого «Hello, World». Дальше вы можете попытаться изучить туториал [«Tour of Heroes»](https://angular.io/tutorial) и создать небольшое приложение, которое поможет в будущем разрабатывать более сложные приложения с помощью Angular, но я бы порекомендовал посмотреть [видеокурс на Udemy](https://www.udemy.com/learn-angular-from-scratch/) (неважно, что он на английском, вы сможете разобраться в силу того, что там все доступно показывается). Для ознакомления с командами angular-cli, вы можете перейти на [данный русскоязычный ресурс](https://dev.nvx.me/angular-cli-ref/). Сейчас же можно ознакомиться с каталогом проекта.

### Каталог проекта

Angular CLI является удобным инструментом для разработки и развертывания enterprise-решений. Для начала самый первый файл, который вам необходимо изучить это README.md. 
Он содержит информацию о базовых командах, которые вы должны знать при использовании Angular CLI. Всякий раз, когда вам потребуется узнать больше, чем есть в README и посмотреть какие-нибудь примеры использования Angular CLI, вам достаточно будет зайти на официальный репозиторий и открыть раздел [Wiki](https://github.com/angular/angular-cli/wiki). 

Некоторые из сгенерированных файлов могут быть вам незнакомы, поэтому поговорим о них подробнее. 

#### Директория src 

Сами исходники вашего разрабатываемого приложения, как правило, располагаются в директории src. Тут вы будете хранить Angular компоненты, шаблоны, стили, изображения и все остальное, что будет необходимо вашему приложению. Любые файлы вне этой папки предназначены для поддержки создания, сборки и развертывания вашего приложения. 

```bash
.
|-- app
|   |-- app.component.css
|   |-- app.component.html
|   |-- app.component.spec.ts
|   |-- app.component.ts
|   `-- app.module.ts
|-- assets
|-- environments
|   |-- environment.prod.ts
|   `-- environment.ts
|-- favicon.ico
|-- index.html
|-- main.ts
|-- polyfills.ts
|-- styles.css
|-- test.ts
|-- tsconfig.app.json
|-- tsconfig.spec.json
`-- typings.d.ts
```

**app/app.component.{ts,html,css,spec.ts}** - специфицирует AppComponent компонент html-шаблоном, стилями и юнит-тестами. Это корневой компонент, для которого по мере развития приложения появится [дерево вложенных компонентов](https://alligator.io/angular/architecture-angular-app/).

**app/app.module.ts** -  специфицирует AppModule. Корневой модуль, который сообщает Angular, как будет собрано приложение. Сейчас в нем объявлен только AppComponent. Впоследствии вы будете объявлять в нем другие компоненты. 

<b>assets/*</b> -  директория, в которой вы размещаете изображения и все остальное, которую необходимо скопировать в конечную директорию сборки, когда вы создадите непосредственно само приложение. 

<b>environments/*</b> -  эта директория содержит файлы целей сборки (dev или prod режимы), каждый из которых экспортирует простые env-переменные конфигурации, необходимые для использования в вашем приложении. Когда вы разрабатываете приложение, файлы собираются «на лету». Вы можете использовать разный набор API при разработке (dev), отличный от продакшина (prod), у которого вы можете подключать всякие метрики или auth-токены. Вы даже можете использовать разные сервисы или заглушки при разных целях сборки. 

**favicon.ico**  - вы можете добавить свою собственную иконку, которая будет отображаться на вкладке в браузере. 

**index.html** - основная HTML-страница, которая отображается, когда кто-то посещает ваш сайт. В большинстве случаев вам никогда не понадобится его редактировать. Angular CLI автоматически добавляет все сгенерированные js и css-файлы при создании вашего приложения, поэтому вам не нужно добавлять какие-либо теги (script, link) вручную. 

**main.ts** - точка входа вашего приложения. Сейчас, по умолчанию, ваше приложение компилируется в поставке с JIT-компилятором. Данный файл загружает корневой модуль приложения (AppModule) и запускает его в браузере. Вы также можете использовать AOT-компилятор, заранее скомпилировав свое приложение, исключив JIT-компилятор из сборки, для этого вы должны использовать флаг —aot для команд Angular CLI ng build и ng serve. 

**polyfills.ts** -  различные браузеры имеют различные уровни поддержки тех или иных веб-стандартов. Полифиллы помогают нормализовать эти различия. Однако не забывайте проверять текущую [поддержку браузерами](https://angular.io/guide/browser-support). 

**styles.css** -  здесь хранятся глобальные стили. Большую часть времени вы будете работать с локальными стилями своих компонентов, но стили, которые влияют на все ваше приложение, должны находиться в этом месте. 

**test.ts**  -  это точка входа всех ваших юнит-тестов. Этот файл имеет настраиваемую конфигурацию, но, как правило, вы будете редко его править. 

**tsconfig.{app|spec}.json** - конфигурация компилятора TypeScript описывается в файле tsconfig.app.json, для юнит-тестов же используется конфигурация tsconfig.spec.json.

#### Корневая директория проекта

src/ является только одним из элементов корневой директории проекта. Другие файлы помогают собирать, тестировать, поддерживать, документировать и развертывать приложение. 

```bash
.
|-- README.md
|-- e2e
|-- karma.conf.js
|-- node_modules
|-- package-lock.json
|-- package.json
|-- protractor.conf.js
|-- src
|-- tsconfig.json
`-- tslint.json
``` 

**e2e/** - внутри директории e2e/ располагаются e2e (end-to-end) тесты. Они не должны находиться внутри директории src/, поскольку эти тесты представляют собой отдельное приложение, которое тестирует ваше основное приложение. Внутри располагаются конфигурационные файлы, например, tsconfig.e2e.json. 

**node_modules/** - Node.js создает данную директорию, в которой хранит все сторонние модули, перечисленные в package.json. 

**.angular-cli.json** - конфигурационный файл Angular CLI. В этом файле вы можете установить несколько значений по умолчанию, а также настроить, какие файлы будут включены при сборке проекта. 

**.editorconfig** - Простая настройка для вашего редактора, специфицирующая одинаковую базовую конфигурацию для форматирования текста кода. Большинство редакторов поддерживают файл .editorconfig. Дополнительную информацию смотрите на странице [http://editorconfig.org](http://editorconfig.org).

**.gitignore** - это файл необходим для системы контроля версий, он нужен, чтобы исключить автосгенерированные файлы, которые не нужно хранить в Git-репозитории. 

**karma.conf.js** - конфигурационный файл для запуска юнит-тестов с использованием Karma, запуск тестов можно выполнить командой ng test. 

**package.json** - конфигурационный файл npm, в нем перечисляются сторонние модули (пакеты) разработчиков, которые использует ваш проект. Здесь вы также можете прописать и свои собственные скрипты. 

**README.md** - основная документация для вашего проекта, предварительно заполненная информацией Angular CLI. 

**tsconfig.json** - конфигурация компилятора TypeScript для вашей IDE.

**tslint.json** - конфигурация для статического анализатора TSLint, используется при запуске ng lint. Для чего нужен анализатор вы можете [посмотрев на пример](http://codelyzer.com/).

#### Developer Experience

![](https://habrastorage.org/webt/r_/_g/su/r__gsubxs8cz3mhxdpcwdm6la0o.png)
 
### Angular CLI vs. Manual Setup

Существует множество способов, которые вы можете опробовать для создания нового проекта на Angular. Но на самом деле существует два основных подхода, первый из них - это использование Angular CLI, а второе — ручная настройка Webpack. 

#### Angular CLI

Самый простой и быстрый способ создания нового проекта на Angular. Не прибегая к ручной настройке, вы можете в течение нескольких минут развернуть проект и начать разрабатывать без проблем даже большие приложения. 

Плюсы:
- Быстрая и простая в установке, идеально подходит для начинающих 
- Является надстройкой над Webpack 
- Включает в себя инструменты тестирования Protractor e2e, Karma, Jasmine 
- Не нужно самостоятельно следить за зависимостями 
- Централизованный конфигурационный файл 
- Быстрые и простые CLI-команды для запуска приложения, создания новых компонентов и многое другое 

Минусы:
- Менее расширенная конфигурация (невозможно изменить встроенную конфигурацию Webpack) 
- Жесткая структура конфигурационных файлов (несколько tsconfig файлов, которые сложнее перемещать из директории в директорию) 
- Слабая поддержка или полное отсутствие плагинов (невозможно, к примеру, добавить Pug-шаблонизатор) 

Все плюсы и минусы действительно сводятся к следующему: c Angular CLI намного легче управлять проектом, но также он делает проект менее гибким. Это отлично подходит для начинающих или простых проектов, но, скорее всего, в будущем вам потребуется ручной подход настройки вашего проекта. 

#### Webpack

В этом случае ручная настройка с использованием Webpack фактически является противоположностью плюсам и минусам Angular CLI. Однако одним из лучших альтернатив Angular CLI, с точки зрения гибкости настройки, является проект AngularClass [Angular Webpack Starter](https://github.com/AngularClass/angular-starter). Однако за счет легкого конфигурирования webpack вы можете настроить простое окружения для своего проекта, оставив [только необходимое](https://github.com/Angular-RU/webpack-angular-starter). 

Плюсы:
- Расширенная настройка Webpack 
- Возможность использования любых HTML-шаблонизаторов 
- Чистый конфигурационный файл и структура каталогов 
- Большая гибкость (конфигурационные файлы являются javascript файлами, для которых можно писать свою логику) 

Минусы:
- Трудность настройки эффективного e2e-тестирования 
- Возможность расширенной конфигурации увеличивает вероятность конфигурационных ошибок 
- Проблемы с зависимостями и их upgrade-обновлениями

#### SystemJS

SystemJS позиционирует себя как универсальный динамический загрузчик модулей — модулей ES6, AMD, CommonJS и глобальных браузерных или Node.js пакетов. Поскольку вы используете модули в TypeScript, так же, как в ES6, вам нужен загрузчик модулей (в Webpack за это отвечают loaders). В случае с SystemJS вы пишете конфигурационный systemjs.config.js, который позволяет вам настроить способ сопоставления имен модулей с их соответствующими файлами в каталоге node_modules или где-либо еще. 

Этот конфигурационный файл необходим для того случая, когда на клиенте вы используете именно SystemJS, при помощи него вы импортируете основной модуль вашего приложения: 


```html
<script>
  System.import('app').catch(function(err){ console.error(err); });
</script>
```

Причем забегая вперед, для TypeScript конфигурации вы указывали определенный параметр [типа модуля](https://auth0.com/blog/javascript-module-systems-showdown/):

```json
{
  "compilerOptions": {
    "target": "es5",
    "module": "commonjs", // <------
    ...
```

Таким образом, после компиляции из TypeScript в ваших JavaScript файлах вы увидели бы внутри особые функции require(). Если бы указали "module": "es6", вы увидели бы в скомпилированных файлах ключевые слова import, export. Однако, вы все еще не можете использовать этот синтаксис, поскольку полной поддержки браузерами еще нет. Если бы указали тип "module": "amd", вы увидели бы другой синтаксис, который использовал функции define(). Стоит отметить, что в обучающем туториале на официальном сайте «Tour of Heroes» до сих пор в примерах участвует SystemJS, однако, после выхода Angular 5, разработчики вскоре поправят документацию и заменят на примеры с Angular CLI. 

SystemJS как одна из модульных систем сборки, предназначалась для того, чтобы эмулировать поддержку ES6 модулей, а как только браузеры начнут их поддерживать, можно было бы от него легко избавиться, однако, в целом эта затея провалилась из-за минусов SystemJS. 

Webpack это достаточно гибкая система сборки. Он не только обрабатывает какие-либо типы модулей (ES6, AMD, CommonJS), но и позволяет выполнить прилегающие задачи, обеспечивая выполнение сжатия, минификации каких-либо файлов, работу с картинками, css-препроцессорами и многое другое. Он также предоставляет веб-сервер для разработки в режиме инкрементальной сборки. Когда вы используете Webpack, SystemJS становится избыточным. Webpack готовит для вас как минимум один файл с возможным именем bundle.js. Этот файл может содержит все необходимые HTML, CSS, JS составляющие ваших веб-компонентов. Поскольку все файлы объединены в один файл, то нет жесткой необходимости в ленивом загрузчике, такой как у SystemJS. Главный потенциал SystemJS был в ленивой загрузке ваших файлов. Приложение должно было загружаться быстрее, потому что вы не загружаете один большой бандл, но на практике это оказалось не очень выгодным решением. 

Но даже сейчас Webpack позволяет использовать вынесение кода из общего бандла (code splitting) и подгружать их при помощи ленивой загрузки по требованию, а также представляет улучшенный Tree Shaking для ваших модулей. Поэтому начиная с версии 1.2, Angular CLI использует внутри себя реализацию Webpack. 

На самом деле, уже практически невозможно найти какой-либо работающий Starter Kit, использующий SystemJS, многие либо переписали на Webpack, либо забросили. Но даже если вы и найдете его, он будет скорее всего с версией Angular 2. Поэтому настоятельно рекомендую изучать первые два способа сборки ваших приложений на Angular. 

#### Rollup

Здесь мы не будем много говорить на эту тему. Хотя есть [примеры](https://gist.github.com/Rich-Harris/79a02519fb00837e8d5a4b24355881c0) (хоть и в сравнении с Webpack второй версии), какой код генерирует Webpack, а какой генерирует Rollup на выходе, и тут последний куда лучше. При этом стоит снова отметить, что Webpack - это не просто сборщик модулей, а куда больше. Поэтому Webpack, как правило, лучше подходит для разработки приложений, а Rollup, как правило, лучше подходит для разработки библиотек.
